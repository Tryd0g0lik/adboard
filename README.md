[//]: # (django-registration 5.2.1)

[//]: # (https://django-registration.readthedocs.io/en/stable/)

# Доска объявлений

[Frontend](https://github.com/Tryd0g0lik/adboard_frotend)\

Note: Пока без учета ограничений.


## Объявления
Загрузка страницы запускает загрузки объявлений из db.\ 
Каждая строка, под капотом содержит индекс. \
Нажимая на кнопку перейти, вытаскиваем индекс из HTML и переходим на \
индивидуальную страницу объявления.

Страница содержит контекст обявления и пока ещё шаблон для чата между владельцем и покупателем.

![ads all](./img/ads.png)


## Пользователь
### 'adboard' - регистрация & авторизация пользователей
*`dashboard/views::LogingViewSet.create`* регистрация по умолчанию Django.\
*`dashboard/views::LogingViewSet.login_user`* авторизация по умолчанию Django.\
**Note**: 
1. Асинхронный код.
2. Пользователь получает редирект на страницу авторизации (если статус код 201 при регистрации).
3. Пользователь получает редирект (временно ->> ) на главную  (статус код 201 при авторизации).

Отправляем\
```json
{
  "username": "Name",
  "password": "password"
}
```

|Данные перед|сохранением|авторизации|
|:----|:----|:----|
|"`username`"|проходят проверку на дубликат||
|"`password`"|хэшируем|[хэшируем, совместно с "`username`" наличие проверяем в базе данных|

### Response: JWT для пользователя
DRF-JWT библиотека используется для получения токенов.
- '`settings.SIMPLE_JWT`';
- '`settings.REST_FRAMEWORK`' настройки по умолчанию.

Один шаблон "`templates/ad/index.html`" подгружает [форму для регистрации](http://83.166.245.197/users/register/) \
и для аутентификации. Какую форму грузить, зависит от URL. 

### Формы

|регистрации|авторизации|
|:----:|:----:|
|![Registration](./img/register.png)|![Registration](./img/login.png)|

[//]: # ( ! [efter authentification]&#40;./img/after_login.png&#41;)

## DB
![db graph](./img/db_ads.png)
Объявления - для метода удаления (delete) применил полиморфизм с транзакцией и \
сигналом для запуска проверки. \
'`ads/signals/ad_deletion.py`'

Изображения (файлы) - можно удалить без каскадного удаления всего, что ссылается на нег
    Для сохранения изображения в хранилище, применил полиморфизм для метода '`save`'.\
    Свойство '`upload_to`' из '`ImageField`' меняем маршрут по заданному формату.\ 
Формат маршрута для хранения изображения: '`media/<user_pk>/%Y/%m/%d/images/< file_namwe >`'  

ExchangeProposal\ 
Комментарий - можно удалить без каскадного удаления всего, что ссылается на него.

Объявление не можем поросто так  комментарии. При этом файлы не удаляются. \
Файлы могут использовать в других предложениях (группах).

Пользователя импортируем из базовой таблицы User.
Пользователя не можем просто так удалить, пока есть объявления, комментарии \
которые он отправляет и (или) получает.
    И в комментариях есть изображения принадлежащие пользователю
'`ads/signals/user_deletion.py`'


## О разном
В '`settings`':
 - База данных настроена на '`Postgres`'; 
 - Проверка '`username`' на дублирование; 
 - Hash паролей и проверка при авторизации;
 - '`LANGUAGE_CODE`' = '`ru`'; 
 - '`TIME_ZONE`' = '`Asia/Krasnoyarsk`'; 
 - CORS и '`CSRF_TRUSTED_ORIGINS`';
 - '`WEBPACK_LOADER`' для работы с совместо с фронтом в режиме разработки;
 - '`__tests__`' - тест файлы. Запуск вручную командой '`pytest`';
 - '`logs.py`' конфигурация логирования прописана. В корне проекта логи '`log_putout.log`'. 
 
**Note:**:
1. *При сборке для '`prodaction`' удалить логи из кода*.
2. *"`py manage.py collectstatis --clear --noinput`"* если изменилась статика.


